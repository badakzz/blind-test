(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[49],{95440:function(e,t,n){let r=n(52921);r.config({path:"../env/local.env"});let o=n(62795),a=n(95522)(o.production);e.exports=a},62795:function(e,t,n){var r=n(93542);let o=n(52921),a=n(15153);o.config({path:a.resolve("/","../env/local.env")});let s={development:{client:"pg",connection:{host:r.env.POSTGRES_HOST,port:r.env.POSTGRES_PORT,user:r.env.POSTGRES_USER,password:r.env.POSTGRES_PASSWORD,database:r.env.POSTGRES_DATABASE},migrations:{directory:a.join("/","db","migrations")},seeds:{directory:a.join("/","db","seeds")}},production:{client:"pg",connection:r.env.DATABASE_URL,migrations:{directory:a.join("/","db","migrations")},seeds:{directory:a.join("/","db","seeds","production")}}};e.exports=s},89717:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/views/chat/chatroom",function(){return n(38886)}])},38886:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSP:function(){return T},default:function(){return O}});var r=n(52322),o=n(2784),a=n(28380),s=n(70561),i=n(94325);let l=o.forwardRef((e,t)=>{let{isLoading:n,LeftIcon:o,RightIcon:a,children:l,...c}=e;return(0,r.jsxs)(s.Z,{...c,className:"".concat((null==c?void 0:c.className)||""," d-flex align-items-center justify-content-center"),children:[n&&(0,r.jsx)(i.Z,{animation:"border",size:"sm"}),!!o&&!n&&(0,r.jsx)(o,{size:12,className:"me-2"}),!n&&l,!!a&&!n&&(0,r.jsx)(a,{size:12,className:"ms-2"})]})});l.displayName="Button";let c=e=>{let{messages:t,connectedUsers:n,user:a,socket:s}=e,[i,l]=(0,o.useState)(""),c=()=>{i&&(s.emit("chatMessage",i,a.user_id),l(""))};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{children:t.map((e,t)=>(0,r.jsxs)("div",{children:[(0,r.jsxs)("span",{children:[e.user_name,": "]}),(0,r.jsx)("span",{children:e.message})]},t))}),(0,r.jsxs)("div",{children:[(0,r.jsx)("input",{type:"text",value:i,onChange:e=>l(e.target.value)}),(0,r.jsx)("button",{onClick:c,children:"Send"})]}),(0,r.jsxs)("div",{children:["Users online:",n.map(e=>e.user_name).join(", ")]})]})},u=e=>{let{onCreate:t,onJoin:n,user:a}=e,[s,i]=(0,o.useState)(a?a.user_name:""),[l,c]=(0,o.useState)(""),u=e=>{e.preventDefault(),t(s)},d=e=>{e.preventDefault(),n(s,l)};return(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"username",children:"Username:"}),(0,r.jsx)("input",{type:"text",id:"username",value:s,readOnly:!!a,onChange:e=>i(e.target.value),required:!0}),(0,r.jsx)("label",{htmlFor:"chatroomId",children:"Chatroom ID (leave blank to create a new room):"}),(0,r.jsx)("input",{type:"text",id:"chatroomId",value:l,onChange:e=>c(e.target.value)}),(0,r.jsx)("button",{onClick:u,children:"Create Room"}),(0,r.jsx)("button",{onClick:d,children:"Join Room"})]})};n(47251);var d=n(22382),h=n(79644).Buffer;let f="",m=async()=>{let e=await d.Z.post("https://accounts.spotify.com/api/token",null,{params:{grant_type:"client_credentials"},headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic ".concat(h.from("".concat("8d38a65dff9043f5a3b6347289960af1",":").concat("3ce88440fc4f4863a6975db64062a7b2")).toString("base64"))}});f=e.data.access_token},p=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"US",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"en_US";f||await m();let n=await d.Z.get("https://api.spotify.com/v1/browse/categories",{headers:{Authorization:"Bearer ".concat(f)},params:{country:e,locale:t}});return n.data.categories.items},g=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"US",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"en_US";f||await m();let r=await d.Z.get("https://api.spotify.com/v1/browse/categories/".concat(e,"/playlists"),{headers:{Authorization:"Bearer ".concat(f)},params:{country:t,locale:n}});return r.data.playlists.items},v=async(e,t)=>{f||await m();let n=await d.Z.get("https://api.spotify.com/v1/playlists/".concat(e,"/tracks"),{headers:{Authorization:"Bearer ".concat(f)}}),r=n.data.items.filter(e=>e.track.preview_url);if(0===r.length)throw Error("No tracks with previews found in the playlist.");let o=[];for(let e=0;e<t;e++){let e=r[Math.floor(Math.random()*r.length)];o.push({previewUrl:e.track.preview_url,name:e.track.name,artist:e.track.artists[0].name})}return o},S=e=>{let{show:t,onPlaylistSelected:n,onModalClose:a}=e,[s,i]=(0,o.useState)(null),[l,c]=(0,o.useState)([]);(0,o.useEffect)(()=>{let e=async()=>{let e=await p().then(e=>e.map(e=>e.id)),t=e.map(e=>g(e)),n=await Promise.all(t),r=n.reduce((e,t)=>t?e.concat(t.filter(e=>null!==e)):e,[]),o=Array.from(new Set(r.map(e=>e.id))).map(e=>r.find(t=>t.id===e));c(o)};e()},[]);let u=e=>{i(e.target.value)},d=()=>{s&&(n(s),a())};return(0,r.jsx)("div",{style:{display:t?"block":"none"},children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{children:"Select a Playlist"}),(0,r.jsx)("select",{onChange:u,children:l.map(e=>(0,r.jsx)("option",{value:e.id,children:e.name},e.id))}),(0,r.jsx)("button",{onClick:d,children:"Submit"}),(0,r.jsx)("button",{onClick:a,children:"Close"})]})})};n(12436);var x=(0,o.createContext)({showErrorToast:function(){},showSuccessToast:function(){}});n(95440);let j=async(e,t,n,r,o,a)=>{if(e(!0),!t[0]||!t[0].previewUrl)return console.error("Invalid first track or track.previewUrl is not defined."),null;{let e=n(t[0],t,r,o,a);return e}},y=(e,t,n,r,o)=>{if(r)return console.log("Playlist stopped"),null;if(console.log("artist",e.artist),console.log("song",e.name),!e||!e.previewUrl){console.error("Invalid song or song.previewUrl is not defined.");return}return o.src=e.previewUrl,o.volume=.2,o.play().catch(e=>{console.error("Failed to play the track:",e)}),o.onerror=e=>{console.error("An error occurred while trying to play the audio:",e)},o.onended=()=>{n(e=>{let a=e+1;return a<10&&t[a]&&setTimeout(()=>{y(t[a],t,n,r,o)},5e3),a})},o};function w(e){return(e=(e=e.toLowerCase().replace(/[^\w\s-]/gi,"")).replace(/ *\([^)]*\) */g," ")).includes("-")&&(e=e.substring(e.indexOf("-")+1)),(e=e.replace(/^\d+\s/,"")).includes("feat")&&(e=e.substring(0,e.indexOf("feat"))),e=e.replace(/\s+/g," ").trim()}let _=(e,t)=>{let n=[];for(let e=0;e<=t.length;e++)n[e]=[e];for(let t=0;t<=e.length;t++)n[0][t]=t;for(let r=1;r<=t.length;r++)for(let o=1;o<=e.length;o++)t.charAt(r-1)===e.charAt(o-1)?n[r][o]=n[r-1][o-1]:n[r][o]=Math.min(n[r-1][o-1]+1,n[r][o-1]+1,n[r-1][o]+1);return n[t.length][e.length]},b=(e,t)=>{let n=_(e,t),r=Math.max(e.length,t.length);return(r-n)/r},C=(e,t,n,r)=>{let o=0,a="",s=t.every((e,t)=>void 0!==n[t]&&b(e,n[t])>=.9),i=r.every((e,t)=>void 0!==n[t]&&b(e,n[t])>=.9);return s&&!i&&(o+=.5,a="song name"),i&&!s&&(o+=.5,a="artist name"),i&&s&&(o+=1,a="artist and the song names"),{points:o,correctGuessType:a,userId:e}};n(13919);var k=n(15318),E=n(82066);let A=e=>{let{chatroomId:t}=e,[n,a]=(0,o.useState)(!0),i=()=>a(!1),{showErrorToast:l}=(0,o.useContext)(x);(0,E.useQueryClient)();let c=async e=>d.Z.get("/api/".concat(e,"/scores")).then(e=>{let{data:t}=e;return t}),{isLoading:u,error:h,data:f,isSuccess:m}=(0,E.useQuery)("scoreboard",()=>c(t),{onError:e=>l(e)});return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(k.Z,{show:n,onHide:i,children:[(0,r.jsx)(k.Z.Header,{closeButton:!0,children:(0,r.jsx)(k.Z.Title,{children:"Game End Scores"})}),(0,r.jsx)(k.Z.Body,{children:f&&!u&&f.map((e,t)=>(0,r.jsxs)("p",{children:[e.user_name,": ",e.points]},t))}),(0,r.jsx)(k.Z.Footer,{children:(0,r.jsx)(s.Z,{variant:"secondary",onClick:i,children:"Close"})})]})})},U=e=>{let{user:t}=e,[n,s]=(0,o.useState)(null),[i,l]=(0,o.useState)([]),[d,h]=(0,o.useState)([]),[f,m]=(0,o.useState)(!1),[p,g]=(0,o.useState)(null),[x,_]=(0,o.useState)([]),[b,k]=(0,o.useState)(!1),[E,U]=(0,o.useState)(!1),[T,O]=(0,o.useState)(0),[P,R]=(0,o.useState)(null),[Z,N]=(0,o.useState)(null),[B,M]=(0,o.useState)(null),[F,G]=(0,o.useState)(!1),[I,z]=(0,o.useState)(!1),[D,H]=(0,o.useState)(!1),W=(0,o.useRef)(new Audio);(0,o.useEffect)(()=>{if(p){let e=async()=>{let e=await v(p,10);_(t=>[...t,...e])};e()}},[p]),(0,o.useEffect)(()=>{let e=(0,a.io)("http://localhost:3001");return s(e),e.on("chatroomCreated",e=>{let t=window.location.href,n="".concat(t,"?chatroomId=").concat(e);alert("Chatroom created! Share this link with others to join: ".concat(n)),R(e)}),e.on("users",e=>{h(e)}),()=>{e.off("chatroomCreated"),e.disconnect()}},[]),(0,o.useEffect)(()=>{if(n&&D){if(!I)return n.on("gameStarted",e=>{_(e);let t=j(U,e,y,O,F,W.current);t&&O(0),H(!1)}),()=>{n.off("gameStarted")};{_(x);let e=j(U,x,y,O,F,W.current);e&&O(0),H(!1)}}},[n,D]),(0,o.useEffect)(()=>{x&&x[T]&&(N(x[T].name),M(x[T].artist))},[x,T]),(0,o.useEffect)(()=>{if(n)return n.off("chatMessage"),n.off("scoreUpdated"),n.on("chatMessage",(e,r)=>{if(l(t=>[...t,e]),e.user_id===t.user_id){let r=w(e.message).split(" "),o=w(Z).split(" "),a=w(B).split(" "),s=C(t.user_id,o,r,a);s.points>0&&n.emit("updateScore",P,t.user_id,s.points,s.correctGuessType,Z,B)}}),n.on("scoreUpdated",e=>{let{user:t,correctGuessType:r}=e,o={user_name:"System",message:"".concat(t.user_name," has correctly guessed the ").concat(r,"!")};n.emit("chatMessage",o,t.user_id)}),()=>{n.off("chatMessage"),n.off("scoreUpdated")}},[n,Z,B,t]),(0,o.useEffect)(()=>{if(n)return n.on("gameOver",(e,t)=>{G(!0),W.current&&W.current instanceof Audio?W.current.pause():console.error("Audio object is not defined or not an instance of Audio."),console.log("Final scores:",e),console.log("Winner:",t)}),()=>{n.off("gameOver")}},[n]);let J=e=>{let r=e;t?r=t.user_name:e||(r="guest".concat(d.length+1)),r&&(n.emit("createRoom",e),m(!0),z(!0))},L=(e,r)=>{if(r){let o=e;t?o=t.user_name:e||(o="guest".concat(d.length+1)),o&&(m(!0),z(!1),H(!0),R(r),n.emit("joinRoom",e,r))}},Q=()=>{k(!0)},X=()=>{k(!1)},q=e=>{g(e)},K=()=>{n.emit("startGame",P,x),H(!0)};return(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{children:"Chatroom"}),!f&&(0,r.jsx)(u,{user:t,onCreate:J,onJoin:L}),f&&!p&&(0,r.jsx)(r.Fragment,{children:I?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{onClick:Q,children:"Select Playlist"}),(0,r.jsx)(S,{show:b,onPlaylistSelected:q,onModalClose:X})]}):"Waiting for the host to launch the game"}),p&&!E&&(0,r.jsx)("button",{onClick:()=>{K(),U(!0)},children:"Start Game"}),E&&(0,r.jsx)(c,{messages:i,user:t,connectedUsers:d,socket:n}),F&&(0,r.jsx)(A,{chatroomId:P})]})};var T=!0,O=U},53736:function(){},19283:function(){},46683:function(){},8739:function(){},52037:function(){},45895:function(){},15189:function(){},12668:function(){},17318:function(){},27171:function(){},53260:function(){},37770:function(){}},function(e){e.O(0,[934,911,774,888,179],function(){return e(e.s=89717)}),_N_E=e.O()}]);